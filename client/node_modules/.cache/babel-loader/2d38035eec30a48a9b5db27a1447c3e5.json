{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Factory_1 = require(\"../Factory\");\n\nvar Node_1 = require(\"../Node\");\n\nvar Util_1 = require(\"../Util\");\n\nvar Validators_1 = require(\"../Validators\");\n\nexports.Emboss = function (imageData) {\n  var strength = this.embossStrength() * 10,\n      greyLevel = this.embossWhiteLevel() * 255,\n      direction = this.embossDirection(),\n      blend = this.embossBlend(),\n      dirY = 0,\n      dirX = 0,\n      data = imageData.data,\n      w = imageData.width,\n      h = imageData.height,\n      w4 = w * 4,\n      y = h;\n\n  switch (direction) {\n    case 'top-left':\n      dirY = -1;\n      dirX = -1;\n      break;\n\n    case 'top':\n      dirY = -1;\n      dirX = 0;\n      break;\n\n    case 'top-right':\n      dirY = -1;\n      dirX = 1;\n      break;\n\n    case 'right':\n      dirY = 0;\n      dirX = 1;\n      break;\n\n    case 'bottom-right':\n      dirY = 1;\n      dirX = 1;\n      break;\n\n    case 'bottom':\n      dirY = 1;\n      dirX = 0;\n      break;\n\n    case 'bottom-left':\n      dirY = 1;\n      dirX = -1;\n      break;\n\n    case 'left':\n      dirY = 0;\n      dirX = -1;\n      break;\n\n    default:\n      Util_1.Util.error('Unknown emboss direction: ' + direction);\n  }\n\n  do {\n    var offsetY = (y - 1) * w4;\n    var otherY = dirY;\n\n    if (y + otherY < 1) {\n      otherY = 0;\n    }\n\n    if (y + otherY > h) {\n      otherY = 0;\n    }\n\n    var offsetYOther = (y - 1 + otherY) * w * 4;\n    var x = w;\n\n    do {\n      var offset = offsetY + (x - 1) * 4;\n      var otherX = dirX;\n\n      if (x + otherX < 1) {\n        otherX = 0;\n      }\n\n      if (x + otherX > w) {\n        otherX = 0;\n      }\n\n      var offsetOther = offsetYOther + (x - 1 + otherX) * 4;\n      var dR = data[offset] - data[offsetOther];\n      var dG = data[offset + 1] - data[offsetOther + 1];\n      var dB = data[offset + 2] - data[offsetOther + 2];\n      var dif = dR;\n      var absDif = dif > 0 ? dif : -dif;\n      var absG = dG > 0 ? dG : -dG;\n      var absB = dB > 0 ? dB : -dB;\n\n      if (absG > absDif) {\n        dif = dG;\n      }\n\n      if (absB > absDif) {\n        dif = dB;\n      }\n\n      dif *= strength;\n\n      if (blend) {\n        var r = data[offset] + dif;\n        var g = data[offset + 1] + dif;\n        var b = data[offset + 2] + dif;\n        data[offset] = r > 255 ? 255 : r < 0 ? 0 : r;\n        data[offset + 1] = g > 255 ? 255 : g < 0 ? 0 : g;\n        data[offset + 2] = b > 255 ? 255 : b < 0 ? 0 : b;\n      } else {\n        var grey = greyLevel - dif;\n\n        if (grey < 0) {\n          grey = 0;\n        } else if (grey > 255) {\n          grey = 255;\n        }\n\n        data[offset] = data[offset + 1] = data[offset + 2] = grey;\n      }\n    } while (--x);\n  } while (--y);\n};\n\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossStrength', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossWhiteLevel', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossDirection', 'top-left', null, Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossBlend', false, null, Factory_1.Factory.afterSetFilter);","map":{"version":3,"sources":["/home/jun/foodbank/node_modules/konva/lib/filters/Emboss.js"],"names":["Object","defineProperty","exports","value","Factory_1","require","Node_1","Util_1","Validators_1","Emboss","imageData","strength","embossStrength","greyLevel","embossWhiteLevel","direction","embossDirection","blend","embossBlend","dirY","dirX","data","w","width","h","height","w4","y","Util","error","offsetY","otherY","offsetYOther","x","offset","otherX","offsetOther","dR","dG","dB","dif","absDif","absG","absB","r","g","b","grey","Factory","addGetterSetter","Node","getNumberValidator","afterSetFilter"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Util_1 = require(\"../Util\");\nvar Validators_1 = require(\"../Validators\");\nexports.Emboss = function (imageData) {\n    var strength = this.embossStrength() * 10, greyLevel = this.embossWhiteLevel() * 255, direction = this.embossDirection(), blend = this.embossBlend(), dirY = 0, dirX = 0, data = imageData.data, w = imageData.width, h = imageData.height, w4 = w * 4, y = h;\n    switch (direction) {\n        case 'top-left':\n            dirY = -1;\n            dirX = -1;\n            break;\n        case 'top':\n            dirY = -1;\n            dirX = 0;\n            break;\n        case 'top-right':\n            dirY = -1;\n            dirX = 1;\n            break;\n        case 'right':\n            dirY = 0;\n            dirX = 1;\n            break;\n        case 'bottom-right':\n            dirY = 1;\n            dirX = 1;\n            break;\n        case 'bottom':\n            dirY = 1;\n            dirX = 0;\n            break;\n        case 'bottom-left':\n            dirY = 1;\n            dirX = -1;\n            break;\n        case 'left':\n            dirY = 0;\n            dirX = -1;\n            break;\n        default:\n            Util_1.Util.error('Unknown emboss direction: ' + direction);\n    }\n    do {\n        var offsetY = (y - 1) * w4;\n        var otherY = dirY;\n        if (y + otherY < 1) {\n            otherY = 0;\n        }\n        if (y + otherY > h) {\n            otherY = 0;\n        }\n        var offsetYOther = (y - 1 + otherY) * w * 4;\n        var x = w;\n        do {\n            var offset = offsetY + (x - 1) * 4;\n            var otherX = dirX;\n            if (x + otherX < 1) {\n                otherX = 0;\n            }\n            if (x + otherX > w) {\n                otherX = 0;\n            }\n            var offsetOther = offsetYOther + (x - 1 + otherX) * 4;\n            var dR = data[offset] - data[offsetOther];\n            var dG = data[offset + 1] - data[offsetOther + 1];\n            var dB = data[offset + 2] - data[offsetOther + 2];\n            var dif = dR;\n            var absDif = dif > 0 ? dif : -dif;\n            var absG = dG > 0 ? dG : -dG;\n            var absB = dB > 0 ? dB : -dB;\n            if (absG > absDif) {\n                dif = dG;\n            }\n            if (absB > absDif) {\n                dif = dB;\n            }\n            dif *= strength;\n            if (blend) {\n                var r = data[offset] + dif;\n                var g = data[offset + 1] + dif;\n                var b = data[offset + 2] + dif;\n                data[offset] = r > 255 ? 255 : r < 0 ? 0 : r;\n                data[offset + 1] = g > 255 ? 255 : g < 0 ? 0 : g;\n                data[offset + 2] = b > 255 ? 255 : b < 0 ? 0 : b;\n            }\n            else {\n                var grey = greyLevel - dif;\n                if (grey < 0) {\n                    grey = 0;\n                }\n                else if (grey > 255) {\n                    grey = 255;\n                }\n                data[offset] = data[offset + 1] = data[offset + 2] = grey;\n            }\n        } while (--x);\n    } while (--y);\n};\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossStrength', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossWhiteLevel', 0.5, Validators_1.getNumberValidator(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossDirection', 'top-left', null, Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'embossBlend', false, null, Factory_1.Factory.afterSetFilter);\n"]},"metadata":{},"sourceType":"script"}