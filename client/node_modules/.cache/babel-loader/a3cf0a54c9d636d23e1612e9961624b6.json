{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/jun/foodbank/client/src/Pages/Game/index.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport AnimatedNumber from 'animated-number-react';\nimport Konva from 'konva';\nimport * as React from 'react';\nimport { allFoods, backgrounds, getAndRemoveItem } from './helper';\nimport useGameAlert from './useGameAlert';\nconst TOTAL_FOOD = allFoods.length;\nconst width = window.innerWidth;\nconst height = window.innerHeight;\nconst stage = new Konva.Stage({\n  container: 'dank',\n  width: width,\n  height: height\n});\nconst layer = new Konva.Layer();\nstage.add(layer);\nconst tempLayer = new Konva.Layer();\nstage.add(tempLayer);\n\nconst drawBoard = () => {\n  const drawImage = ({\n    scale,\n    x,\n    y,\n    px,\n    py,\n    start,\n    end,\n    len,\n    name\n  }) => function () {\n    const group = new Konva.Group({\n      x,\n      y,\n      clipFunc: function (ctx) {\n        ctx.beginPath();\n        ctx.moveTo(px, py);\n        ctx.arc(px, py, len, start, Math.PI - end, false);\n      }\n    });\n    const options = {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      image: this,\n      name,\n      scaleX: scale,\n      scaleY: scale\n    };\n    const konvaImage = new Konva.Image(options);\n    group.add(konvaImage);\n    layer.add(group);\n    layer.draw();\n  };\n\n  backgrounds.forEach(b => {\n    const image = new Image();\n    image.onload = drawImage(b);\n    image.src = b.src;\n  });\n};\n\nconst categorisedCharNames = [];\n\nconst Game = () => {\n  _s();\n\n  var _currentCharacter$tar2, _currentCharacter$tar3;\n\n  const [currentCharacter, setCurrentCharacter] = React.useState();\n  const [remainingCharacters, setRemainingCharacters] = React.useState(allFoods);\n  const {\n    error,\n    success,\n    finishGame\n  } = useGameAlert();\n\n  const getAndUpdateRandomChar = () => {\n    // handle game end\n    let availableChars = remainingCharacters;\n\n    if (!remainingCharacters.length) {\n      finishGame();\n      setRemainingCharacters(allFoods);\n      availableChars = allFoods;\n    }\n\n    const [randomChar, updated] = getAndRemoveItem(availableChars, 'image');\n    setRemainingCharacters(updated);\n    if (!randomChar) return;\n    setTimeout(() => {\n      Konva.Image.fromURL(randomChar.image, function (image) {\n        // Scaling image based on original size. Currently uses a hacky way to do it but made the images more consistent in size\n        const imageHeight = image.attrs.image.height;\n        const desiredHeight = 169;\n        const scale = desiredHeight / imageHeight;\n        image.setAttrs({\n          x: stage.width() / 1.4,\n          y: stage.height() / 2,\n          scaleX: scale,\n          scaleY: scale,\n          draggable: true,\n          name: randomChar.name,\n          foodGroup: randomChar.type\n        });\n        image.on('mouseover', function () {\n          document.body.style.cursor = 'pointer';\n        });\n        image.on('mouseout', function () {\n          document.body.style.cursor = 'default';\n        }); // add the shape to the layer\n\n        layer.add(image);\n        layer.draw();\n      });\n    }, 0);\n  };\n\n  function getCurrentCharacter() {\n    var _currentCharacter$tar;\n\n    const {\n      name,\n      foodGroup\n    } = (currentCharacter === null || currentCharacter === void 0 ? void 0 : (_currentCharacter$tar = currentCharacter.target) === null || _currentCharacter$tar === void 0 ? void 0 : _currentCharacter$tar.attrs) || {};\n    return {\n      name,\n      foodGroup\n    };\n  }\n\n  const handleRemoveSuccess = ({\n    name,\n    foodGroup\n  }) => {\n    success({\n      name,\n      foodGroup\n    });\n    setCurrentCharacter(null);\n    getAndUpdateRandomChar();\n    categorisedCharNames.push(name);\n  };\n\n  const removeCharacter = (name, foodGroup, currentFoodGroup) => {\n    const found = stage.find(`.${name}`);\n\n    if (foodGroup === currentFoodGroup) {\n      if (found) {\n        found.each(f => {\n          f.destroy();\n          return f.hide();\n        });\n        handleRemoveSuccess({\n          name,\n          foodGroup\n        });\n      } else {\n        alert(`${name} is not found in the canvas GG ðŸ”¥`);\n      }\n    } else {\n      error({\n        name,\n        foodGroup\n      });\n    }\n  };\n\n  React.useEffect(getAndUpdateRandomChar, []);\n  React.useEffect(drawBoard, []);\n  React.useEffect(() => {\n    stage.on('dragstart', function (e) {\n      setCurrentCharacter(e);\n      e.target.moveTo(tempLayer);\n      layer.draw();\n    });\n    let previousShape;\n    stage.on('dragmove', function (evt) {\n      const pos = stage.getPointerPosition();\n      const shape = layer.getIntersection(pos);\n\n      if (previousShape && shape) {\n        if (previousShape !== shape) {\n          var _previousShape;\n\n          // leave from old targer\n          (_previousShape = previousShape) === null || _previousShape === void 0 ? void 0 : _previousShape.fire('dragleave', {\n            type: 'dragleave',\n            target: previousShape,\n            evt: evt.evt\n          }, true); // enter new targer\n\n          shape === null || shape === void 0 ? void 0 : shape.fire('dragenter', {\n            type: 'dragenter',\n            target: shape,\n            evt: evt.evt\n          }, true);\n          previousShape = shape;\n        } else {\n          previousShape.fire('dragover', {\n            type: 'dragover',\n            target: previousShape,\n            evt: evt.evt\n          }, true);\n        }\n      } else if (!previousShape && shape) {\n        previousShape = shape;\n        shape.fire('dragenter', {\n          type: 'dragenter',\n          target: shape,\n          evt: evt.evt\n        }, true);\n      } else if (previousShape && !shape) {\n        var _previousShape2;\n\n        (_previousShape2 = previousShape) === null || _previousShape2 === void 0 ? void 0 : _previousShape2.fire('dragleave', {\n          type: 'dragleave',\n          target: previousShape,\n          evt: evt.evt\n        }, true);\n        previousShape = undefined;\n      }\n    });\n    stage.on('dragend', function (e) {\n      const pos = stage.getPointerPosition();\n      const shape = layer.getIntersection(pos);\n\n      if (shape) {\n        var _previousShape3;\n\n        (_previousShape3 = previousShape) === null || _previousShape3 === void 0 ? void 0 : _previousShape3.fire('drop', {\n          type: 'drop',\n          target: previousShape,\n          evt: e.evt\n        }, true);\n      }\n\n      previousShape = undefined;\n      e.target.moveTo(layer);\n      layer.draw();\n      tempLayer.draw();\n    });\n    stage.on('dragenter', function () {\n      layer.draw();\n    });\n    stage.on('dragleave', function () {\n      layer.draw();\n    });\n    stage.on('dragover', function () {\n      layer.draw();\n    });\n  }, []);\n\n  const setOnDrop = () => {\n    stage.on('drop', e => {\n      const {\n        name,\n        foodGroup: currentFoodGroup\n      } = getCurrentCharacter();\n      if (!name || !currentFoodGroup || categorisedCharNames.some(categorised => categorised === name)) return;\n      const foodGroup = e.target.attrs.name;\n      removeCharacter(name, foodGroup, currentFoodGroup);\n      layer.draw();\n      tempLayer.draw();\n    });\n  };\n\n  React.useEffect(setOnDrop, [currentCharacter === null || currentCharacter === void 0 ? void 0 : (_currentCharacter$tar2 = currentCharacter.target) === null || _currentCharacter$tar2 === void 0 ? void 0 : (_currentCharacter$tar3 = _currentCharacter$tar2.attrs) === null || _currentCharacter$tar3 === void 0 ? void 0 : _currentCharacter$tar3.name]);\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    children: /*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"flex justify-around\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-5xl font-thin\",\n        children: [\"Score:\", ' ', /*#__PURE__*/_jsxDEV(AnimatedNumber, {\n          value: TOTAL_FOOD - remainingCharacters.length - 1,\n          formatValue: value => value.toFixed(1)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-5xl font-thin\",\n        children: [\"Remaining Food: \", remainingCharacters.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 289,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Game, \"jJv3L/GfBG4Jb+TfvgRpXY55i54=\", false, function () {\n  return [useGameAlert];\n});\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"sources":["/home/jun/foodbank/client/src/Pages/Game/index.tsx"],"names":["AnimatedNumber","Konva","React","allFoods","backgrounds","getAndRemoveItem","useGameAlert","TOTAL_FOOD","length","width","window","innerWidth","height","innerHeight","stage","Stage","container","layer","Layer","add","tempLayer","drawBoard","drawImage","scale","x","y","px","py","start","end","len","name","group","Group","clipFunc","ctx","beginPath","moveTo","arc","Math","PI","options","image","scaleX","scaleY","konvaImage","Image","draw","forEach","b","onload","src","categorisedCharNames","Game","currentCharacter","setCurrentCharacter","useState","remainingCharacters","setRemainingCharacters","error","success","finishGame","getAndUpdateRandomChar","availableChars","randomChar","updated","setTimeout","fromURL","imageHeight","attrs","desiredHeight","setAttrs","draggable","foodGroup","type","on","document","body","style","cursor","getCurrentCharacter","target","handleRemoveSuccess","push","removeCharacter","currentFoodGroup","found","find","each","f","destroy","hide","alert","useEffect","e","previousShape","evt","pos","getPointerPosition","shape","getIntersection","fire","undefined","setOnDrop","some","categorised","value","toFixed"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport AnimatedNumber from 'animated-number-react'\nimport Konva from 'konva'\nimport * as React from 'react'\nimport { allFoods, backgrounds, getAndRemoveItem, FoodImage } from './helper'\nimport useGameAlert from './useGameAlert'\n\nconst TOTAL_FOOD = allFoods.length\nconst width = window.innerWidth\nconst height = window.innerHeight\n\nconst stage = new Konva.Stage({\n  container: 'dank',\n  width: width,\n  height: height,\n})\n\nconst layer = new Konva.Layer()\nstage.add(layer)\n\nconst tempLayer = new Konva.Layer()\nstage.add(tempLayer)\n\nconst drawBoard = () => {\n  const drawImage = ({ scale, x, y, px, py, start, end, len, name }: any) =>\n    function () {\n      const group = new Konva.Group({\n        x,\n        y,\n        clipFunc: function (ctx) {\n          ctx.beginPath()\n          ctx.moveTo(px, py)\n          ctx.arc(px, py, len, start, Math.PI - end, false)\n        }\n      })\n      const options = {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        image: this,\n        name,\n        scaleX: scale,\n        scaleY: scale\n      } as any\n\n      const konvaImage = new Konva.Image(options)\n\n      group.add(konvaImage)\n      layer.add(group)\n\n      layer.draw()\n    }\n\n  backgrounds.forEach(b => {\n    const image = new Image()\n    image.onload = drawImage(b)\n    image.src = b.src\n  })\n}\n\nconst categorisedCharNames: string[] = []\n\nconst Game: React.FC = () => {\n  const [currentCharacter, setCurrentCharacter] = React.useState<any>()\n  const [remainingCharacters, setRemainingCharacters] = React.useState<\n    FoodImage[]\n  >(allFoods)\n\n  const { error, success, finishGame } = useGameAlert()\n\n  const getAndUpdateRandomChar = () => {\n    // handle game end\n    let availableChars: FoodImage[] = remainingCharacters\n    if (!remainingCharacters.length) {\n      finishGame()\n      setRemainingCharacters(allFoods)\n      availableChars = allFoods\n    }\n    const [randomChar, updated] = getAndRemoveItem(availableChars, 'image')\n    setRemainingCharacters(updated)\n\n    if (!randomChar) return\n\n    setTimeout(() => {\n      Konva.Image.fromURL(randomChar.image, function (image: any) {\n\n        // Scaling image based on original size. Currently uses a hacky way to do it but made the images more consistent in size\n        const imageHeight = image.attrs.image.height\n        const desiredHeight = 169\n        const scale = desiredHeight/imageHeight\n        \n        image.setAttrs({\n          x: stage.width() / 1.4,\n          y: stage.height() / 2,\n          scaleX: scale,\n          scaleY: scale,\n          draggable: true,\n          name: randomChar.name,\n          foodGroup: randomChar.type\n        })\n\n        image.on('mouseover', function () {\n          document.body.style.cursor = 'pointer'\n        })\n        image.on('mouseout', function () {\n          document.body.style.cursor = 'default'\n        })\n\n        // add the shape to the layer\n        layer.add(image)\n        layer.draw()\n\n      })\n    }, 0)\n  }\n\n  function getCurrentCharacter(): {\n    name: string | undefined\n    foodGroup: string | undefined\n  } {\n    const { name, foodGroup } = currentCharacter?.target?.attrs || {}\n    return { name, foodGroup }\n  }\n\n  const handleRemoveSuccess = ({\n    name,\n    foodGroup\n  }: {\n    name: string\n    foodGroup: string\n  }) => {\n    success({ name, foodGroup })\n    setCurrentCharacter(null)\n    getAndUpdateRandomChar()\n    categorisedCharNames.push(name)\n  }\n\n  const removeCharacter = (\n    name: string,\n    foodGroup: string,\n    currentFoodGroup: string\n  ) => {\n    const found = stage.find(`.${name}`)\n    if (foodGroup === currentFoodGroup) {\n      if (found) {\n        found.each(f => {\n          f.destroy()\n          return f.hide()\n        })\n        handleRemoveSuccess({ name, foodGroup })\n      } else {\n        alert(`${name} is not found in the canvas GG ðŸ”¥`)\n      }\n    } else {\n      error({ name, foodGroup })\n    }\n  }\n\n  React.useEffect(getAndUpdateRandomChar, [])\n\n  React.useEffect(drawBoard, [])\n\n  React.useEffect(() => {\n    stage.on('dragstart', function (e) {\n      setCurrentCharacter(e)\n      e.target.moveTo(tempLayer)\n      layer.draw()\n    })\n    let previousShape: any\n    stage.on('dragmove', function (evt) {\n      const pos = stage.getPointerPosition() as any\n      const shape = layer.getIntersection(pos)\n      if (previousShape && shape) {\n        if (previousShape !== shape) {\n          // leave from old targer\n          previousShape?.fire(\n            'dragleave',\n            {\n              type: 'dragleave',\n              target: previousShape,\n              evt: evt.evt\n            },\n            true\n          )\n\n          // enter new targer\n          shape?.fire(\n            'dragenter',\n            {\n              type: 'dragenter',\n              target: shape,\n              evt: evt.evt\n            },\n            true\n          )\n          previousShape = shape\n        } else {\n          previousShape.fire(\n            'dragover',\n            {\n              type: 'dragover',\n              target: previousShape,\n              evt: evt.evt\n            },\n            true\n          )\n        }\n      } else if (!previousShape && shape) {\n        previousShape = shape\n        shape.fire(\n          'dragenter',\n          {\n            type: 'dragenter',\n            target: shape,\n            evt: evt.evt\n          },\n          true\n        )\n      } else if (previousShape && !shape) {\n        previousShape?.fire(\n          'dragleave',\n          {\n            type: 'dragleave',\n            target: previousShape,\n            evt: evt.evt\n          },\n          true\n        )\n        previousShape = undefined\n      }\n    })\n    stage.on('dragend', function (e) {\n      const pos = stage.getPointerPosition() as any\n\n      const shape = layer.getIntersection(pos)\n      if (shape) {\n        previousShape?.fire(\n          'drop',\n          {\n            type: 'drop',\n            target: previousShape,\n            evt: e.evt\n          },\n          true\n        )\n      }\n      previousShape = undefined\n      e.target.moveTo(layer)\n      layer.draw()\n      tempLayer.draw()\n    })\n\n    stage.on('dragenter', function () {\n      layer.draw()\n    })\n\n    stage.on('dragleave', function () {\n      layer.draw()\n    })\n\n    stage.on('dragover', function () {\n      layer.draw()\n    })\n  }, [])\n\n  const setOnDrop = () => {\n    stage.on('drop', (e: any) => {\n      const { name, foodGroup: currentFoodGroup } = getCurrentCharacter()\n      if (\n        !name ||\n        !currentFoodGroup ||\n        categorisedCharNames.some(categorised => categorised === name)\n      )\n        return\n\n      const foodGroup = e.target.attrs.name\n\n      removeCharacter(name, foodGroup, currentFoodGroup)\n      layer.draw()\n      tempLayer.draw()\n    })\n  }\n\n  React.useEffect(setOnDrop, [currentCharacter?.target?.attrs?.name])\n\n  return (\n    <main>\n      <header className='flex justify-around'>\n        <h2 className='text-5xl font-thin'>\n          Score:{' '}\n          <AnimatedNumber\n            value={TOTAL_FOOD - remainingCharacters.length - 1}\n            formatValue={(value: number) => value.toFixed(1)}\n          />\n        </h2>\n        <h2 className='text-5xl font-thin'>\n          Remaining Food: {remainingCharacters.length}\n        </h2>\n      </header>\n    </main>\n  )\n}\n\nexport default Game\n"]},"metadata":{},"sourceType":"module"}