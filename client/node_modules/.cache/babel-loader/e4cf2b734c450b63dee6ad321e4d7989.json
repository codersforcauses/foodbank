{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/jun/foodbank/client/src/Pages/Game/index.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport AnimatedNumber from 'animated-number-react';\nimport DropNotification from 'Components/DropNotification';\nimport Konva from 'konva';\nimport * as React from 'react';\nimport { allFoods, backgrounds, getAndRemoveItem } from './helper';\nimport useGameAlert from './useGameAlert';\nimport { nanoid } from 'nanoid';\nconst BACKGROUND_PURPLE = '#671E75';\nconst TOTAL_FOOD = allFoods.length;\nconst width = window.innerWidth;\nconst height = window.innerHeight;\nconst stage = new Konva.Stage({\n  container: 'dank',\n  width: width,\n  height: height,\n  visible: true\n});\nconst layer = new Konva.Layer();\nstage.add(layer);\nconst tempLayer = new Konva.Layer();\nstage.add(tempLayer);\n\nconst drawBoard = () => {\n  const drawImage = ({\n    scale,\n    x,\n    y,\n    px,\n    py,\n    start,\n    end,\n    len,\n    name\n  }) => function () {\n    const group = new Konva.Group({\n      x,\n      y,\n\n      clipFunc(ctx) {\n        ctx.beginPath();\n        ctx.moveTo(px, py);\n        ctx.arc(px, py, len, start, Math.PI - end, false);\n      }\n\n    });\n    const options = {\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      image: this,\n      name,\n      scaleX: scale,\n      scaleY: scale\n    };\n    const konvaImage = new Konva.Image(options);\n    group.add(konvaImage);\n    layer.add(group);\n    layer.draw();\n  };\n\n  backgrounds.forEach(b => {\n    const image = new Image();\n    image.onload = drawImage(b);\n    image.src = b.src;\n  });\n};\n\nconst categorisedCharNames = [];\n\nconst Game = () => {\n  _s();\n\n  var _currentCharacter$tar2, _currentCharacter$tar3;\n\n  const [currentCharacter, setCurrentCharacter] = React.useState();\n  const [remainingCharacters, setRemainingCharacters] = React.useState(allFoods);\n  const {\n    error,\n    success,\n    finishGame\n  } = useGameAlert();\n\n  const getAndUpdateRandomChar = () => {\n    // handle game end\n    let availableChars = remainingCharacters;\n\n    if (!remainingCharacters.length) {\n      finishGame();\n      setRemainingCharacters(allFoods);\n      availableChars = allFoods;\n    }\n\n    const [randomChar, updated] = getAndRemoveItem(availableChars, 'image');\n    setRemainingCharacters(updated);\n    if (!randomChar) return;\n    setTimeout(() => {\n      Konva.Image.fromURL(randomChar.image, function (image) {\n        // Scaling image based on original size. Currently uses a hacky way to do it but made the images more consistent in size\n        const imageHeight = image.attrs.image.height;\n        const desiredHeight = 169;\n        const scale = desiredHeight / imageHeight;\n        image.setAttrs({\n          x: stage.width() / 1.4,\n          y: stage.height() / 2,\n          scaleX: scale,\n          scaleY: scale,\n          draggable: true,\n          name: randomChar.name,\n          foodGroup: randomChar.type,\n          stroke: 'black',\n          strokeWidth: 10\n        });\n        image.on('mouseover', function () {\n          document.body.style.cursor = 'pointer';\n        });\n        image.on('mouseout', function () {\n          document.body.style.cursor = 'default';\n        }); // add the shape to the layer\n\n        layer.add(image);\n        layer.draw();\n      });\n    }, 0);\n  };\n\n  function getCurrentCharacter() {\n    var _currentCharacter$tar;\n\n    const {\n      name,\n      foodGroup\n    } = (currentCharacter === null || currentCharacter === void 0 ? void 0 : (_currentCharacter$tar = currentCharacter.target) === null || _currentCharacter$tar === void 0 ? void 0 : _currentCharacter$tar.attrs) || {};\n    return {\n      name,\n      foodGroup\n    };\n  }\n\n  const handleRemoveSuccess = ({\n    name,\n    foodGroup\n  }) => {\n    //This is where it calls the notification of a successful run\n    //success({ name, foodGroup })\n    showSuccessNotification(name, foodGroup); //correctNotification(name, foodGroup)\n\n    setCurrentCharacter(null);\n    getAndUpdateRandomChar();\n    categorisedCharNames.push(name);\n  };\n\n  const removeCharacter = (name, foodGroup, currentFoodGroup) => {\n    const found = stage.find(`.${name}`);\n\n    if (foodGroup === currentFoodGroup) {\n      if (found) {\n        found.each(f => {\n          f.destroy();\n          return f.hide();\n        });\n        handleRemoveSuccess({\n          name,\n          foodGroup\n        });\n      } else {\n        alert(`${name} is not found in the canvas GG ðŸ”¥`);\n      }\n    } else {\n      //This is the display notification for an unsuccessful character placement\n      //error({ name, foodGroup })\n      showErrorNotification(name, foodGroup);\n    }\n  };\n\n  React.useEffect(getAndUpdateRandomChar, []);\n  React.useEffect(drawBoard, []);\n  React.useEffect(() => {\n    stage.on('dragstart', function (e) {\n      setCurrentCharacter(e);\n      e.target.moveTo(tempLayer);\n      layer.draw();\n    });\n    let previousShape;\n    stage.on('dragmove', function (evt) {\n      const pos = stage.getPointerPosition();\n      const shape = layer.getIntersection(pos);\n\n      if (previousShape && shape) {\n        if (previousShape !== shape) {\n          var _previousShape;\n\n          // leave from old targer\n          (_previousShape = previousShape) === null || _previousShape === void 0 ? void 0 : _previousShape.fire('dragleave', {\n            type: 'dragleave',\n            target: previousShape,\n            evt: evt.evt\n          }, true); // enter new targer\n\n          shape === null || shape === void 0 ? void 0 : shape.fire('dragenter', {\n            type: 'dragenter',\n            target: shape,\n            evt: evt.evt\n          }, true);\n          previousShape = shape;\n        } else {\n          previousShape.fire('dragover', {\n            type: 'dragover',\n            target: previousShape,\n            evt: evt.evt\n          }, true);\n        }\n      } else if (!previousShape && shape) {\n        previousShape = shape;\n        shape.fire('dragenter', {\n          type: 'dragenter',\n          target: shape,\n          evt: evt.evt\n        }, true);\n      } else if (previousShape && !shape) {\n        var _previousShape2;\n\n        (_previousShape2 = previousShape) === null || _previousShape2 === void 0 ? void 0 : _previousShape2.fire('dragleave', {\n          type: 'dragleave',\n          target: previousShape,\n          evt: evt.evt\n        }, true);\n        previousShape = undefined;\n      }\n    });\n    stage.on('dragend', function (e) {\n      const pos = stage.getPointerPosition();\n      const shape = layer.getIntersection(pos);\n\n      if (shape) {\n        var _previousShape3;\n\n        (_previousShape3 = previousShape) === null || _previousShape3 === void 0 ? void 0 : _previousShape3.fire('drop', {\n          type: 'drop',\n          target: previousShape,\n          evt: e.evt\n        }, true);\n      }\n\n      previousShape = undefined;\n      e.target.moveTo(layer);\n      layer.draw();\n      tempLayer.draw();\n    });\n    stage.on('dragenter', function () {\n      layer.draw();\n    });\n    stage.on('dragleave', function () {\n      layer.draw();\n    });\n    stage.on('dragover', function () {\n      layer.draw();\n    });\n  }, []);\n\n  const setOnDrop = () => {\n    stage.on('drop', e => {\n      const {\n        name,\n        foodGroup: currentFoodGroup\n      } = getCurrentCharacter();\n      if (!name || !currentFoodGroup || categorisedCharNames.some(categorised => categorised === name)) return;\n      const foodGroup = e.target.attrs.name;\n      removeCharacter(name, foodGroup, currentFoodGroup);\n      layer.draw();\n      tempLayer.draw();\n    });\n  };\n\n  React.useEffect(setOnDrop, [currentCharacter === null || currentCharacter === void 0 ? void 0 : (_currentCharacter$tar2 = currentCharacter.target) === null || _currentCharacter$tar2 === void 0 ? void 0 : (_currentCharacter$tar3 = _currentCharacter$tar2.attrs) === null || _currentCharacter$tar3 === void 0 ? void 0 : _currentCharacter$tar3.name]);\n\n  function showSuccessNotification(name, foodgroup) {\n    const successNotification = {\n      message1: 'Correct!',\n      message2: `${name} is a ${foodgroup}`,\n      id: 'notification-' + nanoid()\n    };\n    setNotifications([...notifications, successNotification]);\n  }\n\n  function showErrorNotification(name, foodgroup) {\n    const errorNotification = {\n      message1: 'Uh oh!',\n      message2: `${name} is not a ${foodgroup}`,\n      id: 'notification-' + nanoid()\n    };\n    setNotifications([...notifications, errorNotification]);\n  }\n\n  const place_holder = [];\n  const [notifications, setNotifications] = React.useState(place_holder);\n  const notificationList = notifications.map(notification => /*#__PURE__*/_jsxDEV(DropNotification, {\n    id: notification.id,\n    message1: notification.message1,\n    message2: notification.message2,\n    //delay is the number of seconds before the notification expires (3 seconds)\n    delay: 3000\n  }, notification.id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 326,\n    columnNumber: 5\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"flex justify-around p-5\",\n      style: {\n        background: BACKGROUND_PURPLE\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-5xl font-thin font-serif\",\n        style: {\n          color: 'whitesmoke'\n        },\n        children: [\"Score:\", ' ', /*#__PURE__*/_jsxDEV(AnimatedNumber, {\n          value: TOTAL_FOOD - remainingCharacters.length - 1,\n          formatValue: value => value.toFixed(1)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-5xl font-thin font-serif\",\n        style: {\n          color: 'whitesmoke'\n        },\n        children: [\"Remaining Food: \", remainingCharacters.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 346,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"body\", {\n      className: \"flex justify-center p-5 animate__animated animate__bounce\",\n      children: notificationList\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 337,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Game, \"XDJHCPtGw5B93fc7fnnoxZ8kEBY=\", false, function () {\n  return [useGameAlert];\n});\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"sources":["/home/jun/foodbank/client/src/Pages/Game/index.tsx"],"names":["AnimatedNumber","DropNotification","Konva","React","allFoods","backgrounds","getAndRemoveItem","useGameAlert","nanoid","BACKGROUND_PURPLE","TOTAL_FOOD","length","width","window","innerWidth","height","innerHeight","stage","Stage","container","visible","layer","Layer","add","tempLayer","drawBoard","drawImage","scale","x","y","px","py","start","end","len","name","group","Group","clipFunc","ctx","beginPath","moveTo","arc","Math","PI","options","image","scaleX","scaleY","konvaImage","Image","draw","forEach","b","onload","src","categorisedCharNames","Game","currentCharacter","setCurrentCharacter","useState","remainingCharacters","setRemainingCharacters","error","success","finishGame","getAndUpdateRandomChar","availableChars","randomChar","updated","setTimeout","fromURL","imageHeight","attrs","desiredHeight","setAttrs","draggable","foodGroup","type","stroke","strokeWidth","on","document","body","style","cursor","getCurrentCharacter","target","handleRemoveSuccess","showSuccessNotification","push","removeCharacter","currentFoodGroup","found","find","each","f","destroy","hide","alert","showErrorNotification","useEffect","e","previousShape","evt","pos","getPointerPosition","shape","getIntersection","fire","undefined","setOnDrop","some","categorised","foodgroup","successNotification","message1","message2","id","setNotifications","notifications","errorNotification","place_holder","notificationList","map","notification","background","color","value","toFixed"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport AnimatedNumber from 'animated-number-react'\nimport DropNotification from 'Components/DropNotification'\nimport { clear } from 'console'\nimport Konva from 'konva'\nimport * as React from 'react'\nimport { allFoods, backgrounds, getAndRemoveItem, FoodImage } from './helper'\nimport useGameAlert from './useGameAlert'\nimport {nanoid} from 'nanoid';\n\n\nconst BACKGROUND_PURPLE = '#671E75'\n\n\nconst TOTAL_FOOD = allFoods.length\nconst width = window.innerWidth\nconst height = window.innerHeight\n\nconst stage = new Konva.Stage({\n  container: 'dank',\n  width: width,\n  height: height,\n  visible: true\n})\n\nconst layer = new Konva.Layer()\nstage.add(layer)\n\nconst tempLayer = new Konva.Layer()\nstage.add(tempLayer)\n\nconst drawBoard = () => {\n  const drawImage = ({ scale, x, y, px, py, start, end, len, name }: any) =>\n    function () {\n      const group = new Konva.Group({\n        x,\n        y,\n        clipFunc(ctx: any) {\n          ctx.beginPath()\n          ctx.moveTo(px, py)\n          ctx.arc(px, py, len, start, Math.PI - end, false)\n        }\n      })\n      const options = {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        image: this,\n        name,\n        scaleX: scale,\n        scaleY: scale\n      } as any\n\n      const konvaImage = new Konva.Image(options)\n\n      group.add(konvaImage)\n      layer.add(group)\n\n      layer.draw()\n    }\n\n  backgrounds.forEach(b => {\n    const image = new Image()\n    image.onload = drawImage(b)\n    image.src = b.src\n  })\n}\n\nconst categorisedCharNames: string[] = []\n\nconst Game: React.FC = () => {\n  const [currentCharacter, setCurrentCharacter] = React.useState<any>()\n  const [remainingCharacters, setRemainingCharacters] = React.useState<\n    FoodImage[]\n  >(allFoods)\n\n  const { error, success, finishGame } = useGameAlert()\n\n  const getAndUpdateRandomChar = () => {\n    // handle game end\n    let availableChars: FoodImage[] = remainingCharacters\n    if (!remainingCharacters.length) {\n      finishGame()\n      setRemainingCharacters(allFoods)\n      availableChars = allFoods\n    }\n    const [randomChar, updated] = getAndRemoveItem(availableChars, 'image')\n    setRemainingCharacters(updated)\n\n    if (!randomChar) return\n\n    setTimeout(() => {\n      Konva.Image.fromURL(randomChar.image, function (image: any) {\n\n        // Scaling image based on original size. Currently uses a hacky way to do it but made the images more consistent in size\n        const imageHeight = image.attrs.image.height\n        const desiredHeight = 169\n        const scale = desiredHeight/imageHeight\n        \n        image.setAttrs({\n          x: stage.width() / 1.4,\n          y: stage.height() / 2,\n          scaleX: scale,\n          scaleY: scale,\n          draggable: true,\n          name: randomChar.name,\n          foodGroup: randomChar.type,\n          stroke: 'black',\n          strokeWidth: 10\n        })\n\n        image.on('mouseover', function () {\n          document.body.style.cursor = 'pointer'\n        })\n        image.on('mouseout', function () {\n          document.body.style.cursor = 'default'\n        })\n\n        // add the shape to the layer\n        layer.add(image)\n        layer.draw()\n\n      })\n    }, 0)\n  }\n\n  function getCurrentCharacter(): {\n    name: string | undefined\n    foodGroup: string | undefined\n  } {\n    const { name, foodGroup } = currentCharacter?.target?.attrs || {}\n    return { name, foodGroup }\n  }\n\n  const handleRemoveSuccess = ({\n    name,\n    foodGroup\n  }: {\n    name: string\n    foodGroup: string\n  }) => {\n    //This is where it calls the notification of a successful run\n    //success({ name, foodGroup })\n    showSuccessNotification(name,foodGroup)\n    //correctNotification(name, foodGroup)\n    setCurrentCharacter(null)\n    getAndUpdateRandomChar()\n    categorisedCharNames.push(name)\n  }\n\n  const removeCharacter = (\n    name: string,\n    foodGroup: string,\n    currentFoodGroup: string\n  ) => {\n    const found = stage.find(`.${name}`)\n    if (foodGroup === currentFoodGroup) {\n      if (found) {\n        found.each(f => {\n          f.destroy()\n          return f.hide()\n        })\n        handleRemoveSuccess({ name, foodGroup })\n      } else {\n        alert(`${name} is not found in the canvas GG ðŸ”¥`)\n      }\n    } else {\n      //This is the display notification for an unsuccessful character placement\n      //error({ name, foodGroup })\n      showErrorNotification(name,foodGroup)\n    }\n  }\n\n  React.useEffect(getAndUpdateRandomChar, [])\n\n  React.useEffect(drawBoard, [])\n\n  React.useEffect(() => {\n    stage.on('dragstart', function (e) {\n      setCurrentCharacter(e)\n      e.target.moveTo(tempLayer)\n      layer.draw()\n    })\n    let previousShape: any\n    stage.on('dragmove', function (evt) {\n      const pos = stage.getPointerPosition() as any\n      const shape = layer.getIntersection(pos)\n      if (previousShape && shape) {\n        if (previousShape !== shape) {\n          // leave from old targer\n          previousShape?.fire(\n            'dragleave',\n            {\n              type: 'dragleave',\n              target: previousShape,\n              evt: evt.evt\n            },\n            true\n          )\n\n          // enter new targer\n          shape?.fire(\n            'dragenter',\n            {\n              type: 'dragenter',\n              target: shape,\n              evt: evt.evt\n            },\n            true\n          )\n          previousShape = shape\n        } else {\n          previousShape.fire(\n            'dragover',\n            {\n              type: 'dragover',\n              target: previousShape,\n              evt: evt.evt\n            },\n            true\n          )\n        }\n      } else if (!previousShape && shape) {\n        previousShape = shape\n        shape.fire(\n          'dragenter',\n          {\n            type: 'dragenter',\n            target: shape,\n            evt: evt.evt\n          },\n          true\n        )\n      } else if (previousShape && !shape) {\n        previousShape?.fire(\n          'dragleave',\n          {\n            type: 'dragleave',\n            target: previousShape,\n            evt: evt.evt\n          },\n          true\n        )\n        previousShape = undefined\n      }\n    })\n    stage.on('dragend', function (e) {\n      const pos = stage.getPointerPosition() as any\n\n      const shape = layer.getIntersection(pos)\n      if (shape) {\n        previousShape?.fire(\n          'drop',\n          {\n            type: 'drop',\n            target: previousShape,\n            evt: e.evt\n          },\n          true\n        )\n      }\n      previousShape = undefined\n      e.target.moveTo(layer)\n      layer.draw()\n      tempLayer.draw()\n    })\n\n    stage.on('dragenter', function () {\n      layer.draw()\n    })\n\n    stage.on('dragleave', function () {\n      layer.draw()\n    })\n\n    stage.on('dragover', function () {\n      layer.draw()\n    })\n  }, [])\n\n  const setOnDrop = () => {\n    stage.on('drop', (e: any) => {\n      const { name, foodGroup: currentFoodGroup } = getCurrentCharacter()\n      if (\n        !name ||\n        !currentFoodGroup ||\n        categorisedCharNames.some(categorised => categorised === name)\n      )\n        return\n\n      const foodGroup = e.target.attrs.name\n\n      removeCharacter(name, foodGroup, currentFoodGroup)\n      layer.draw()\n      tempLayer.draw()\n    })\n  }\n\n  React.useEffect(setOnDrop, [currentCharacter?.target?.attrs?.name])\n  \n  function showSuccessNotification(name:string,foodgroup:string){\n    const successNotification = {\n     message1:'Correct!',\n     message2:`${name} is a ${foodgroup}`,\n     id: 'notification-' + nanoid()\n    }\n    setNotifications([...notifications, successNotification])\n  }\n\n  function showErrorNotification(name:string,foodgroup:string){\n    const errorNotification = {\n     message1:'Uh oh!',\n     message2:`${name} is not a ${foodgroup}`,\n     id: 'notification-' + nanoid()\n    }\n    setNotifications([...notifications, errorNotification])\n  }\n\n  const place_holder:any[] = []\n\n  const [notifications, setNotifications] = React.useState(place_holder);\n\n  const notificationList = notifications.map(notification => (\n    <DropNotification\n      id = {notification.id}\n      message1 = {notification.message1}\n      message2 = {notification.message2}\n      key = {notification.id}\n      //delay is the number of seconds before the notification expires (3 seconds)\n      delay = {3000}\n      />\n  ));\n\n  return (\n    <main>\n      <header className='flex justify-around p-5' style={{background:BACKGROUND_PURPLE}}>\n        <h2 className='text-5xl font-thin font-serif' style={{color: 'whitesmoke'}}>\n          Score:{' '}\n          <AnimatedNumber\n            value={TOTAL_FOOD - remainingCharacters.length - 1}\n            formatValue={(value: number) => value.toFixed(1)}\n          />\n        </h2>\n        <h2 className='text-5xl font-thin font-serif' style={{color: 'whitesmoke'}}>\n          Remaining Food: {remainingCharacters.length}\n        </h2>\n      </header>\n      <body className='flex justify-center p-5 animate__animated animate__bounce'>\n        {notificationList}\n      </body>\n    </main>\n  )\n}\n\nexport default Game\n"]},"metadata":{},"sourceType":"module"}